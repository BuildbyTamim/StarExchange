<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Wallet & Exchange</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <section id="login-view" class="center-screen">
        <div class="login-card">
            <div class="login-icon">
                <i class="fa-solid fa-star"></i>
            </div>

            <h1>Star Exchange</h1>
            <p class="subtitle">Convert your Telegram Stars into TON easily.</p>

            <div class="features-grid">
                <div class="feature-item">
                    <i class="fa-solid fa-clock-rotate-left"></i>
                    <span>Track History</span>
                </div>
                <div class="feature-item">
                    <i class="fa-solid fa-wallet"></i>
                    <span>Auto Calc</span>
                </div>
                <div class="feature-item">
                    <i class="fa-solid fa-shield-halved"></i>
                    <span>Secure</span>
                </div>
            </div>

            <div class="telegram-login-container">
                <div id="telegram-login-box">
                    <script async src="https://telegram.org/js/telegram-widget.js?22" 
                        data-telegram-login="web_loginbot" 
                        data-size="large" 
                        data-onauth="onTelegramAuth(user)" 
                        data-request-access="write">
                    </script>
                </div>
            </div>
        </div>
    </section>


    <section id="dashboard-view" class="hidden">
        
        <header class="app-header">
            <div class="profile-area">
                <img id="user-photo" src="assets/default-user.png" alt="User" onerror="this.src='https://placehold.co/50x50/242f3d/FFF?text=U'">
                <div class="profile-text">
                    <h2 id="display-name">Loading...</h2>
                    <span id="username">@username</span>
                </div>
            </div>
            <button onclick="logout()" class="icon-btn"><i class="fa-solid fa-right-from-bracket"></i></button>
        </header>

        <main class="main-content">
            
            <div class="balance-card">
                <div class="card-header">
                    <span>Total Balance</span>
                    <span id="multi-account-badge" class="badge hidden">0 Accounts</span>
                </div>
                
                <div class="balance-amount">
                    <i class="fa-solid fa-star star-gold"></i>
                    <span id="total-stars-count">0</span>
                </div>

                <div class="balance-footer">
                    <p>Est. Value: <span id="ton-value" class="highlight-text">0.00 TON</span></p>
                </div>
            </div>

            <div class="history-section">
                <h3 class="section-title">History & Withdrawals</h3>
                
                <div id="history-list" class="list-container">
                    <div class="empty-state">
                        <p>Loading history...</p>
                    </div>
                </div>
            </div>
        </main>
    </section>


    <div id="withdraw-modal" class="modal-overlay hidden">
        <div class="modal-box">
            <div class="modal-header">
                <h3>Withdraw Request</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <p class="modal-info">You are withdrawing <strong id="modal-star-amount">0</strong> Stars</p>
                
                <form id="withdraw-form">
                    <label>Your TON Wallet Address</label>
                    <input type="text" id="wallet-input" placeholder="UQ..." required>
                    <p class="input-hint">Make sure the address is correct.</p>
                    
                    <button type="submit" class="btn-primary-full">Submit Request</button>
                </form>
            </div>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script src="js/firebase-config.js"></script>
    <script src="js/main.js"></script>

    <script type="text/javascript">
      function onTelegramAuth(user) {
        // ১. কনসোলে ইউজারের তথ্য দেখাবে (টেস্টিং এর জন্য)
        console.log('Logged in as ' + user.first_name + ' ' + user.last_name + ' (' + user.id + (user.username ? ', @' + user.username : '') + ')');
        
        // ২. ইউজারের তথ্য এলার্ট আকারে দেখাবে (আপনি যা চেয়েছিলেন)
        // alert('Welcome ' + user.first_name);

        // ৩. আমাদের মেইন স্ক্রিপ্টে (main.js) ডাটা পাঠাবে
        if(typeof handleTelegramLogin === 'function') {
            handleTelegramLogin(user);
        } else {
            console.error("main.js file is not ready or handleTelegramLogin function is missing.");
        }
      }

    </script>

</body>
</html>
